<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8"/>
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
	<title>Student Dashboard</title>
	<link rel="stylesheet" href="/static/style.css">
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
	{% include 'header.html' %}
	<div class="container">
		<div class="student-profile">
			{% if student.photo_path %}
				<img src="{{ student.photo_path }}" alt="Student Photo">
			{% endif %}
			<div class="student-info">
				<h2>Welcome, {{ student.name }}</h2>
				<p>Roll No: {{ student.roll_no }}</p>
			</div>
		</div>

		<div class="stats-grid">
			<div class="stat-card">
				<h3>Total Classes</h3>
				<div class="value">{{ total|default(0) }}</div>
			</div>
			<div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
				<h3>Present</h3>
				<div class="value">{{ present|default(0) }}</div>
			</div>
			<div class="stat-card" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
				<h3>Absent</h3>
				<div class="value">{{ absent|default(0) }}</div>
			</div>
		</div>

		<div class="chart-container">
			<h3 class="card-title">Overall Attendance (All Subjects)</h3>
			<canvas id="overallPie" width="400" height="400"></canvas>
		</div>

		{% if per_subject %}
		<div class="card">
			<h2 class="card-title">Attendance by Subject</h2>
			<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
				{% for subj in per_subject %}
				<div class="card" style="padding: 20px;">
					<h3 style="margin-top: 0;">{{ subj.name }}</h3>
					<canvas id="subjectChart{{ subj.id }}" width="200" height="200"></canvas>
					<p style="text-align: center; margin-top: 10px;">
						<strong>{{ subj.percent }}%</strong> ({{ subj.present }}/{{ subj.total }})
					</p>
				</div>
				{% endfor %}
			</div>
		</div>
		{% endif %}

		<div class="card">
			<div class="btn-group">
				<a href="/dashboard/student/timetable" class="btn btn-primary">View Timetable</a>
				<a href="/dashboard/student/profile" class="btn btn-primary">Profile</a>
				<a href="/logout" class="btn btn-secondary">Logout</a>
			</div>
		</div>
	</div>

	<script>
		(function() {
			const presentVal = {{ present|default(0)|tojson }};
			const absentVal = {{ absent|default(0)|tojson }};
			const ctx = document.getElementById('overallPie').getContext('2d');
			new Chart(ctx, {
				type: 'pie',
				data: {
					labels: ['Present', 'Absent'],
					datasets: [{
						data: [presentVal, absentVal],
						backgroundColor: ['#10b981', '#ef4444']
					}]
				},
				options: {
					responsive: true,
					plugins: {
						legend: { position: 'bottom' }
					}
				}
			});

			{% if per_subject %}
			const subjectData = {{ per_subject|tojson }};
			subjectData.forEach(function(subj) {
				const ctx = document.getElementById('subjectChart' + subj.id).getContext('2d');
				new Chart(ctx, {
					type: 'pie',
					data: {
						labels: ['Present', 'Absent'],
						datasets: [{
							data: [subj.present, subj.absent],
							backgroundColor: ['#10b981', '#ef4444']
						}]
					},
					options: {
						responsive: true,
						plugins: {
							legend: { position: 'bottom' }
						}
					}
				});
			});
			{% endif %}
		})();
	</script>
</body>
</html>
